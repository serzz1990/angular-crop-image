!function(t){function e(a){if(i[a])return i[a].exports;var o=i[a]={exports:{},id:a,loaded:!1};return t[a].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";i(1),angular.module("angularCropImage",[]).service("CropImage",i(3)).directive("cropImageSource",i(4)).directive("cropImage",i(5))},function(t,e){},,function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}();t.exports=["$document",function(t){var e=function(){function e(t,a){i(this,e),this.$element=t,this.data=angular.extend({},e.DEFAULT,a),this.checkZoom(),this.data.ratio=n.methods.getRatio(this),this.data.size=n.methods.getSize(this),this.data.position=n.methods.getCenterPosition(this),this.__last=this.getStyle(),n.methods.setCss(this),this.listen()}return a(e,[{key:"listen",value:function(){function e(e){o.__disabled||(o.__startChangePosition(e),t.on("mousemove",i).on("mouseup",a).on("touchmove",i).on("touchend",a))}function i(t){return o.__updatePosition(t),!1}function a(e){t.off("mousemove",i).off("mouseup",a).off("touchmove",i).off("touchend",a),o.__stopChangePosition(e)}var o=this;return this.$element.on("mousedown",e).on("touchstart",e),this}},{key:"setZoom",value:function(t){this.data.zoom=t<1?1:t,this.recalcSize()}},{key:"zoomIn",value:function(t){this.__disabled||(this.data.zoom+=t,this.checkZoom(),this.recalcSize())}},{key:"zoomOut",value:function(t){this.__disabled||(this.data.zoom-=t,this.checkZoom(),this.recalcSize())}},{key:"checkZoom",value:function(){this.data.zoom>this.data.maxZoom?this.data.zoom=+this.data.maxZoom:this.data.zoom<this.data.minZoom?this.data.zoom=+this.data.minZoom:this.data.zoom=+this.data.zoom}},{key:"getStyle",value:function(){var t={$element:this.$element,data:{image:{src:(this.$element[0].style.backgroundImage||"none").replace(/^url\(/,"").replace(/\)$/,"")},size:{width:this.$element[0].clientWidth,height:this.$element[0].clientHeight}}};return t.data=angular.extend({},e.DEFAULT,t.data),t}},{key:"cancel",value:function(){this.__disabled||n.methods.setCss(this.__last)}},{key:"recalcSize",value:function(){var t=n.methods.getSize(this);return this.data.position.x+=(t.width-this.data.size.width)/2,this.data.position.y+=(t.height-this.data.size.height)/2,this.data.size=t,this.__checkPosition(),this.$element.css({backgroundSize:t.width+"px "+t.height+"px",backgroundPosition:-1*this.data.position.x+"px "+-1*this.data.position.y+"px"}),this}},{key:"crop",value:function(){var t=this,e=this.getCanvas(),i=this.data.ratio.width<this.data.ratio.height?this.data.ratio.height*this.data.zoom:this.data.ratio.width*this.data.zoom;return e.ctx.clearRect(0,0,e.element.width,e.element.height),e.ctx.restore(),e.ctx.save(),e.ctx.setTransform(i*this.data.pixelRatio,0,0,i*this.data.pixelRatio,-1*this.data.position.x*this.data.pixelRatio,-1*this.data.position.y*this.data.pixelRatio),e.ctx.drawImage(this.data.image,0,0),this.data.image=new Image,this.data.image.src=e.element.toDataURL("image/jpg"),this.data.image.onload=function(){t.data.image.width=t.data.image.width/t.data.pixelRatio,t.data.image.height=t.data.image.height/t.data.pixelRatio,t.data.zoom=1,t.data.ratio=n.methods.getRatio(t),t.data.size=n.methods.getSize(t),t.data.position=n.methods.getCenterPosition(t),n.methods.setCss(t)},this.data.image.src}},{key:"getCanvas",value:function(){if(this.__canvas)return this.__canvas;var t=this.__canvas={};return t.element=document.createElement("canvas"),t.ctx=t.element.getContext("2d"),t.element.width=this.$element[0].clientWidth*this.data.pixelRatio,t.element.height=this.$element[0].clientHeight*this.data.pixelRatio,t}},{key:"__checkPosition",value:function(){if("false"!==this.data.border&&this.data.border){var t=this.data.size.width-this.$element[0].clientWidth,e=this.data.size.height-this.$element[0].clientHeight;t<this.data.position.x?this.data.position.x=t:this.data.position.x<0&&(this.data.position.x=0),e<this.data.position.y?this.data.position.y=e:this.data.position.y<0&&(this.data.position.y=0)}}},{key:"__startChangePosition",value:function(t){this.__changePosition=t,o.addClass("cursor-move")}},{key:"__updatePosition",value:function(t){var e="touchmove"==t.type?t.touches[0]:t,i="touchmove"==t.type?this.__changePosition.touches[0]:this.__changePosition;this.data.position.x+=i.clientX-e.clientX,this.data.position.y+=i.clientY-e.clientY,this.__changePosition=t,this.__checkPosition(),this.$element.css({backgroundPosition:-1*this.data.position.x+"px "+-1*this.data.position.y+"px"})}},{key:"__stopChangePosition",value:function(){this.__changePosition=null,o.removeClass("cursor-move")}},{key:"disabled",set:function(t){this.__disabled=t}}]),e}();e.DEFAULT={image:{src:null,width:0,height:0},position:{x:0,y:0},size:{width:0,height:0},pixelRatio:1,zoom:1,maxZoom:5,minZoom:1,border:!0};var o=angular.element(document.body),n={methods:{getCenterPosition:function(t){return{x:parseInt((t.data.size.width-t.$element[0].clientWidth)/2),y:parseInt((t.data.size.height-t.$element[0].clientHeight)/2)}},getSize:function(t){var e=t.data,i=e.ratio,a=e.image,o=e.zoom;return{width:parseInt(i.width<i.height?a.width*i.height*o:a.width*i.width*o),height:parseInt(i.width<i.height?a.height*i.height*o:a.height*i.width*o)}},getRatio:function(t){return{width:t.$element[0].clientWidth/t.data.image.width,height:t.$element[0].clientHeight/t.data.image.height}},setCss:function(t){t.$element.css({backgroundImage:"url("+t.data.image.src+")",backgroundPosition:-1*t.data.position.x+"px "+-1*t.data.position.y+"px",backgroundSize:t.data.size.width+"px "+t.data.size.height+"px",backgroundRepeat:"no-repeat"})}}};return e}]},function(t,e){"use strict";t.exports=function(){return{restrict:"A",require:"ngModel",link:function(t,e,i,a){e.on("change",function(){var e=this.files[0],i=new FileReader;e&&/image/.test(e.type)&&(i.onload=function(){a.$setViewValue(i.result),t.$apply()},i.readAsDataURL(e))})}}}},function(t,e){"use strict";t.exports=["CropImage",function(t){return{restrict:"A",link:function(e,i,a){var o,n="cropImage",s=a[n],h=angular.extend({},a);e.$watch(s,function(a){a&&(h.image=new Image,h.image.src=a,e.cropImageModeEdit=!0,h.image.onload=function(){return i.data(n,o=new t(i,h))})}),e.cropImageZoom=function(t){o&&o.setZoom(t)},e.cropImageZoomIn=function(t){o&&o.zoomIn(t)},e.cropImageZoomOut=function(t){o&&o.zoomOut(t)},e.cropImageCut=function(){if(o)return e.cropImageModeEdit=!1,o.disabled=!0,o.crop()},e.cropImageCancel=function(){o&&(e.cropImageModeEdit=!1,o.cancel(),o.disabled=!0)}}}}]}]);