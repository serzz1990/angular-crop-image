(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define([], factory);
	else if(typeof exports === 'object')
		exports["angularCropImage"] = factory();
	else
		root["angularCropImage"] = factory();
})(this, function() {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};

/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {

/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;

/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};

/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;

/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}


/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;

/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;

/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";

/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports, __webpack_require__) {

	"use strict";

	var _interopRequire = function (obj) { return obj && obj.__esModule ? obj["default"] : obj; };

	var CropImage = _interopRequire(__webpack_require__(1));

	var cropImageModel = _interopRequire(__webpack_require__(2));

	var cropImage = _interopRequire(__webpack_require__(3));

	angular.module("angularCropImage", []).factory("CropImage", CropImage).directive("cropImageModel", cropImageModel).directive("cropImage", cropImage);

/***/ },
/* 1 */
/***/ function(module, exports) {

	"use strict";

	var _createClass = (function () { function defineProperties(target, props) { for (var key in props) { var prop = props[key]; prop.configurable = true; if (prop.value) prop.writable = true; } Object.defineProperties(target, props); } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

	var _classCallCheck = function (instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } };

	module.exports = function ($document) {
		var CropImage = (function () {
			function CropImage(data) {
				_classCallCheck(this, CropImage);

				angular.extend(this, CropImage.DEFAULT, data);

				this.ratio = _private.methods.getRatio(this);
				this.size = _private.methods.getSize(this);
				this.position = _private.methods.getCenterPosition(this);

				this.__last = this.getStyle();

				_private.methods.setCss(this);

				this.listen();
			}

			_createClass(CropImage, {
				listen: {
					value: function listen() {

						var _self = this;

						this.element.on("mousedown", startChangePosition).on("touchstart", startChangePosition);

						function startChangePosition(event) {

							_self.__startChangePosition(event);

							$document.on("mousemove", updatePosition).on("mouseup", stopChangePosition).on("touchmove", updatePosition).on("touchend", stopChangePosition);
						}

						function updatePosition(event) {

							_self.__updatePosition(event);
							return false;
						}

						function stopChangePosition(event) {

							$document.off("mousemove", updatePosition).off("mouseup", stopChangePosition).off("touchmove", updatePosition).off("touchend", stopChangePosition);

							_self.__stopChangePosition(event);
						}

						return this;
					}
				},
				setZoom: {
					value: function setZoom(val) {

						this.zoom = val < 1 ? 1 : val;

						this.recalcSize();
					}
				},
				zoomIn: {
					value: function zoomIn(rate) {

						this.zoom += rate;

						this.recalcSize();
					}
				},
				zoomOut: {
					value: function zoomOut(rate) {

						this.zoom -= rate;

						if (this.zoom < 1) this.zoom = 1;

						this.recalcSize();
					}
				},
				getStyle: {
					value: function getStyle() {

						var data = {
							element: this.element,
							image: {
								src: (this.element[0].style.backgroundImage || "none").replace(/^url\(/, "").replace(/\)$/, "")
							},
							size: {
								width: this.element[0].clientWidth,
								height: this.element[0].clientHeight
							}
						};

						return angular.extend({}, CropImage.DEFAULT, data);
					}
				},
				cancel: {
					value: function cancel() {

						_private.methods.setCss(this.__last);
					}
				},
				recalcSize: {
					value: function recalcSize() {

						var size = _private.methods.getSize(this);

						this.position.x += (size.width - this.size.width) / 2;
						this.position.y += (size.height - this.size.height) / 2;

						this.size = size;

						this.checkPosition();

						this.element.css({
							backgroundSize: size.width + "px " + size.height + "px",
							backgroundPosition: -1 * this.position.x + "px " + -1 * this.position.y + "px"
						});

						return this;
					}
				},
				crop: {
					value: function crop() {

						var instance = this;
						var canvas = this.getCanvas();
						var scale = this.ratio.width < this.ratio.height ? this.ratio.height * this.zoom : this.ratio.width * this.zoom;

						canvas.ctx.clearRect(0, 0, canvas.element.width, canvas.element.height);
						canvas.ctx.restore();
						canvas.ctx.save();

						canvas.ctx.setTransform(scale * this.pixelRatio, 0, 0, scale * this.pixelRatio, -1 * this.position.x * this.pixelRatio, -1 * this.position.y * this.pixelRatio);
						canvas.ctx.drawImage(this.image, 0, 0);

						this.image = new Image();
						this.image.src = canvas.element.toDataURL("image/jpg");
						this.image.onload = function () {

							instance.image.width = instance.image.width / instance.pixelRatio;
							instance.image.height = instance.image.height / instance.pixelRatio;

							instance.zoom = 1;
							instance.ratio = _private.methods.getRatio(instance);
							instance.size = _private.methods.getSize(instance);
							instance.position = _private.methods.getCenterPosition(instance);

							_private.methods.setCss(instance);
						};

						return this.image.src;
					}
				},
				getCanvas: {
					value: function getCanvas() {

						if (this.__canvas) {
							return this.__canvas;
						}

						var canvas = this.__canvas = {};
						canvas.element = document.createElement("canvas");
						canvas.ctx = canvas.element.getContext("2d");
						canvas.element.width = this.element[0].clientWidth * this.pixelRatio;
						canvas.element.height = this.element[0].clientHeight * this.pixelRatio;

						return canvas;
					}
				},
				checkPosition: {
					value: function checkPosition() {

						var fx = this.size.width - this.element[0].clientWidth;
						var fy = this.size.height - this.element[0].clientHeight;

						if (fx < this.position.x) this.position.x = fx;else if (this.position.x < 0) this.position.x = 0;

						if (fy < this.position.y) this.position.y = fy;else if (this.position.y < 0) this.position.y = 0;
					}
				},
				__startChangePosition: {
					value: function __startChangePosition(event) {

						this.__changePosition = event;

						body.addClass("cursor-move");
					}
				},
				__updatePosition: {
					value: function __updatePosition(event) {

						var _event = event.type == "touchmove" ? event.touches[0] : event;
						var _lastEvent = event.type == "touchmove" ? this.__changePosition.touches[0] : this.__changePosition;

						this.position.x += _lastEvent.clientX - _event.clientX;
						this.position.y += _lastEvent.clientY - _event.clientY;

						this.__changePosition = event;

						this.checkPosition();

						this.element.css({ backgroundPosition: -1 * this.position.x + "px " + -1 * this.position.y + "px" });
					}
				},
				__stopChangePosition: {
					value: function __stopChangePosition() {

						this.__changePosition = null;

						body.removeClass("cursor-move");
					}
				}
			});

			return CropImage;
		})();

		CropImage.DEFAULT = {

			element: null,
			image: {
				src: null,
				width: 0,
				height: 0
			},
			position: {
				x: 0,
				y: 0
			},
			size: {
				width: 0,
				height: 0
			},
			zoom: 1,
			pixelRatio: 1

		};

		var body = angular.element(document.body);

		var _private = {

			methods: {

				getCenterPosition: function (instance) {

					return {
						x: parseInt((instance.size.width - instance.element[0].clientWidth) / 2),
						y: parseInt((instance.size.height - instance.element[0].clientHeight) / 2)
					};
				},

				getSize: function (instance) {
					var ratio = instance.ratio;
					var image = instance.image;
					var zoom = instance.zoom;

					return {
						width: parseInt(ratio.width < ratio.height ? image.width * ratio.height * zoom : image.width * ratio.width * zoom),
						height: parseInt(ratio.width < ratio.height ? image.height * ratio.height * zoom : image.height * ratio.width * zoom)
					};
				},

				getRatio: function (instance) {

					return {
						width: instance.element[0].clientWidth / instance.image.width,
						height: instance.element[0].clientHeight / instance.image.height
					};
				},

				setCss: function (instance) {

					instance.element.css({
						backgroundImage: "url(" + instance.image.src + ")",
						backgroundPosition: -1 * instance.position.x + "px " + -1 * instance.position.y + "px",
						backgroundSize: instance.size.width + "px " + instance.size.height + "px",
						backgroundRepeat: "no-repeat"
					});
				}

			}

		};

		return CropImage;
	};

	module.exports.$inject = ["$document"];

/***/ },
/* 2 */
/***/ function(module, exports) {

	"use strict";

	module.exports = function (CropImage) {

		return {

			restrict: "A",
			link: function (scope, element, attributes) {

				var dirName = "cropImageModel";
				var model = attributes[dirName];

				if (!attributes[dirName]) {

					throw Error("No model name in attr crop-image-model");
				}

				element.on("change", function () {

					var file = this.files[0],
					    reader = new FileReader();

					if (!file || !/image/.test(file.type)) {
						// error this file not Image;
						return;
					}

					reader.onload = function () {

						scope[model] = reader.result;
						scope.$apply();
					};

					reader.readAsDataURL(file);
				});
			}

		};
	};

	module.exports.$inject = [];

/***/ },
/* 3 */
/***/ function(module, exports) {

	"use strict";

	module.exports = function (CropImage) {

		return {

			restrict: "A",

			link: function (scope, element, attributes) {

				var instance;
				var directiveName = "cropImage";
				var zoom = attributes.zoom;
				var source = attributes[directiveName];
				var data = element.data();

				data.element = element;

				scope[zoom] = scope[zoom] || 0;

				scope.$watch(source, function (src) {

					if (!src) return;

					data.image = new Image();
					data.image.src = src;

					scope.cropImageModeEdit = true;

					data.image.onload = function () {
						return element.data(directiveName, instance = new CropImage(data));
					};
				});

				scope.cropImageZoom = function (value) {

					instance.setZoom(value);
				};

				scope.cropImageZoomIn = function (rate) {

					instance.zoomIn(rate);
				};

				scope.cropImageZoomOut = function (rate) {

					instance.zoomOut(rate);
				};

				scope.cropImageCut = function () {

					scope.cropImageModeEdit = false;
					return instance.crop();
				};

				scope.cropImageCancel = function () {

					scope.cropImageModeEdit = false;
					instance.cancel();
				};
			}

		};
	};

	module.exports.$inject = ["CropImage"];

/***/ }
/******/ ])
});
;
//# sourceMappingURL=angularCropImage.min.js.map